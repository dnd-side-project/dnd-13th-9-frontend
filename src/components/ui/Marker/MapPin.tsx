export type MemoType = 'PROPERTY' | 'NEARBY';

export type NearbyTag = 'BAD' | 'CONVENIENCE' | 'GOOD' | 'NOISE' | 'SECURITY' | 'TRAFFIC';

export type MapPinOptions = {
  type: MemoType;
  nearTag?: NearbyTag; // for NEARBY type, selects icon
  size?: number; // px, default 48
  active?: boolean; // emphasize selected
  onClick?: () => void;
};

export function MapPin({ type, nearTag, size = 48, active, onClick }: MapPinOptions): HTMLElement {
  const PRIMARY = '#669AFF';
  const SECONDARY = '#FBA907';

  const baseFill = type === 'NEARBY' ? SECONDARY : PRIMARY; // 핀 배경 색

  const wrapper = document.createElement('div');
  wrapper.style.position = 'relative';
  wrapper.style.width = `38px`;
  wrapper.style.height = `45px`;
  wrapper.style.transform = 'translate(-50%, -100%)';
  wrapper.style.cursor = 'pointer';
  // 기본 섀도우
  wrapper.style.filter = 'drop-shadow(0 2px 8px rgba(0,0,0,0.15))';

  const svgW = 38; // 배경 핀: 38
  const svgH = 45; // 배경 핀: 45
  const circleDia = 32; // 중앙 원: 32
  const circleTop = Math.round(svgH * 0.42); // 중앙 위치 근사치

  wrapper.innerHTML = `
    <div style="position:absolute; inset:0; display:flex; align-items:flex-start; justify-content:center;">
      <!-- 배경 핀 (ico-map-pin.svg path 사용) -->
      <svg width="${svgW}" height="${svgH}" viewBox="0 0 38 46" style="display:block">
        <path d="M18.991 0.804688C29.4795 0.804688 37.9821 9.30726 37.9821 19.7957C37.9821 23.0663 37.1551 26.1435 35.699 28.8299C32.0649 35.5344 24.95 39.6869 19.8961 45.3979C19.4162 45.9402 18.5699 45.9403 18.09 45.3981C13.0369 39.6891 5.92423 35.5401 2.28781 28.8392C0.828721 26.1505 0 23.07 0 19.7957C0 9.30726 8.50257 0.804688 18.991 0.804688Z" fill="${baseFill}"/>
      </svg>
      <!-- 중앙 흰색 원 -->
      <div style="position:absolute; left:50%; top:${circleTop}px; width:${circleDia}px; height:${circleDia}px; background:#FFFFFF; border-radius:9999px; transform:translate(-50%, -50%);"></div>
      <!-- 내부 아이콘 컨테이너 -->
      <div id="pin-inner-icon" style="position:absolute; left:50%; top:${circleTop}px; transform:translate(-50%, -50%);"></div>
    </div>
  `;

  // 내부 아이콘 SVG 매핑 (파일 SVG 그대로 사용)
  const HOUSE = `<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="32" height="32" rx="16" fill="white"/><path d="M3.84387 14H14.9244C15.3974 14 15.8321 13.7403 16.0564 13.3239L19.6938 6.56857C19.8322 6.3116 19.6461 6 19.3542 6H18.8462H10.5107C10.1375 6 9.78274 6.16216 9.53853 6.44437L3.55221 13.3619C3.33601 13.6117 3.51348 14 3.84387 14Z" fill="#3974E7"/><path d="M5.00781 13.2348L11 6.5L17.0078 12.8305V24.9991H6.29351C5.58344 24.9991 5.00781 24.4235 5.00781 23.7134L5.00781 13.2348Z" fill="#90B6FF"/><path d="M17.0078 12H27.0078V23.7143C27.0078 24.4244 26.4322 25 25.7221 25H17.0078V12Z" fill="#699CFF"/><path d="M8.00781 19C8.00781 17.3431 9.35096 16 11.0078 16C12.6647 16 14.0078 17.3431 14.0078 19V25H8.00781V19Z" fill="#3974E7"/><path d="M9.00391 13C9.00391 11.8954 9.89934 11 11.0039 11C12.1085 11 13.0039 11.8954 13.0039 13C13.0039 13.5523 12.5562 14 12.0039 14H10.0039C9.45162 14 9.00391 13.5523 9.00391 13Z" fill="#3974E7"/><path d="M19 17.5C19 16.6716 19.6716 16 20.5 16C21.3284 16 22 16.6716 22 17.5V19.3333V20.4C22 20.7314 21.7314 21 21.4 21H19.6C19.2686 21 19 20.7314 19 20.4V19.3333V17.5Z" fill="#3974E7"/><path d="M23 17.5C23 16.6716 23.6716 16 24.5 16C25.3284 16 26 16.6716 26 17.5V19.3333V20.4C26 20.7314 25.7314 21 25.4 21H23.6C23.2686 21 23 20.7314 23 20.4V19.3333V17.5Z" fill="#3974E7"/><path d="M28.1016 14H17.2061C16.8223 14 16.4585 13.8285 16.2143 13.5325L10.27 6.32728C10.1624 6.19683 10.2552 6 10.4243 6H11.2667H20.848C21.2005 6 21.5374 6.14467 21.7802 6.40018L28.3812 13.3486C28.6146 13.5943 28.4404 14 28.1016 14Z" fill="#4081FF"/></svg>`;

  const NEARBY: Record<NearbyTag, string> = {
    BAD: `<svg width="26" height="26" viewBox="0 0 26 26" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_1877_22927)"><rect width="26" height="26" rx="13" fill="white"/><path d="M4.82767 10.7127C4.58682 12.4055 4.58444 13.6447 5.67353 14.1133C6.26458 14.3676 6.86245 14.1146 7.45517 14.709C10.7252 18.8708 8.34883 16.1956 10.1307 17.3844C12.2492 18.798 13.0832 17.1974 15.2226 17.1443C17.362 17.0912 17.8242 17.7109 19.051 17.1443C20.2778 16.5776 20.2385 14.7081 19.6136 13.9899C21.1305 13.8166 21.0697 10.8264 19.8242 10.7109C20.7736 9.24159 19.9424 7.87112 19.051 7.87045C19.3312 7.55704 19.2423 6.4745 18.7536 5.7903C17.3343 3.80332 12.0261 4.72906 10.5144 5.59304C10.3865 5.66611 10.2447 5.71475 10.0974 5.71499C6.81264 5.72028 6.53719 5.89287 5.97048 6.9789C5.39089 8.08962 5.08163 8.92775 4.82767 10.7127Z" fill="#FBA907"/><path d="M19.6284 13.81C18.8341 13.5195 18.1729 13.5195 17.5117 13.5195" stroke="#FFEFCF" stroke-linecap="round" stroke-linejoin="round"/><path d="M18.9603 7.47953C18.1535 7.15399 17.4889 7.12387 16.8242 7.09375" stroke="#FFEFCF" stroke-linecap="round" stroke-linejoin="round"/><path d="M19.9382 10.5448C18.9155 10.1796 18.1038 10.0655 17.2812 10.0664" stroke="#FFEFCF" stroke-linecap="round" stroke-linejoin="round"/><path d="M9.54661 20.3301C10.0724 18.6296 9.14664 17.224 8.47148 15.9745C8.1083 15.3574 8.30809 14.6057 8.5061 14.0848C8.52907 14.0243 8.561 13.9688 8.6011 13.9181C9.69086 12.5399 11.7482 10.4227 13.675 15.5529C13.6867 15.5841 13.6966 15.6173 13.703 15.65C13.8531 16.4172 13.8556 17.8754 13.8654 18.6751C13.9241 23.5789 8.34308 24.2227 9.54661 20.3301Z" fill="#FBA907"/></g><defs><clipPath id="clip0_1877_22927"><rect width="26" height="26" rx="13" fill="white"/></clipPath></defs></svg>`,
    CONVENIENCE: `<svg width="26" height="26" viewBox="0 0 26 26" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="26" height="26" rx="13" fill="white"/><path d="M5 11.8555H20.9999V19.1697C20.9999 20.1796 20.1812 20.9983 19.1714 20.9983H6.82856C5.81867 20.9983 5 20.1796 5 19.1697V11.8555Z" fill="#FBA907"/><path d="M5.7244 6.25032C5.97329 5.50364 6.67206 5 7.45913 5H18.5374C19.3245 5 20.0233 5.50364 20.2722 6.25032L22.1411 11.8571H3.85547L5.7244 6.25032Z" fill="#FBA907"/><path d="M8.42578 11.8549C8.42578 13.1173 7.40244 14.1406 6.14008 14.1406C4.87772 14.1406 3.85437 13.1173 3.85437 11.8549L8.42578 11.8549Z" fill="#FFEFCF"/><path d="M13 11.8549C13 13.1173 11.9767 14.1406 10.7143 14.1406C9.45194 14.1406 8.42859 13.1173 8.42859 11.8549L13 11.8549Z" fill="#FFEFCF"/><path d="M17.5703 11.8549C17.5703 13.1173 16.547 14.1406 15.2846 14.1406C14.0223 14.1406 12.9989 13.1173 12.9989 11.8549L17.5703 11.8549Z" fill="#FFEFCF"/><path d="M22.1406 11.8549C22.1406 13.1173 21.1173 14.1406 19.8549 14.1406C18.5926 14.1406 17.5692 13.1173 17.5692 11.8549L22.1406 11.8549Z" fill="#FFEFCF"/><path d="M10.7148 17.1137C10.7148 16.1038 11.5335 15.2852 12.5434 15.2852H13.4577C14.4676 15.2852 15.2863 16.1038 15.2863 17.1137V20.9994H10.7148V17.1137Z" fill="#FFEFCF"/><path d="M9.57254 5L8.42969 11.8571H13.0011V5H9.57254Z" fill="#FFDD99"/><path d="M16.4297 5L17.5725 11.8571H22.1439L20.275 6.25032C20.0261 5.50364 19.3274 5 18.5403 5H16.4297Z" fill="#FFDD99"/></svg>`,
    GOOD: `<svg width="26" height="26" viewBox="0 0 26 26" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="26" height="26" rx="13" fill="white"/><path d="M4.82767 14.9983C4.58682 13.3055 4.58444 12.0662 5.67353 11.5976C6.26458 11.3433 6.86245 11.5963 7.45517 11.002C10.7252 6.84011 8.34883 9.51536 10.1307 8.3265C12.2492 6.91296 13.0832 8.51356 15.2226 8.56666C17.362 8.61976 17.8242 8 19.051 8.56666C20.2778 9.13332 20.2385 11.0028 19.6136 11.721C21.1305 11.8944 21.0697 14.8845 19.8242 15C20.7736 16.4693 19.9424 17.8398 19.051 17.8405C19.3312 18.1539 19.2423 19.2364 18.7536 19.9206C17.3343 21.9076 12.0261 20.9819 10.5144 20.1179C10.3865 20.0448 10.2447 19.9962 10.0974 19.996C6.81264 19.9907 6.53719 19.8181 5.97048 18.732C5.39089 17.6213 5.08163 16.7832 4.82767 14.9983Z" fill="#FBA907"/><path d="M19.6284 11.9009C18.8341 12.1914 18.1729 12.1914 17.5117 12.1914" stroke="#FFEFCF" stroke-linecap="round" stroke-linejoin="round"/><path d="M18.9603 18.2314C18.1535 18.5569 17.4889 18.5871 16.8242 18.6172" stroke="#FFEFCF" stroke-linecap="round" stroke-linejoin="round"/><path d="M19.9382 15.1661C18.9155 15.5313 18.1038 15.6454 17.2812 15.6445" stroke="#FFEFCF" stroke-linecap="round" stroke-linejoin="round"/><path d="M9.54661 5.38079C10.0724 7.08131 9.14664 8.48696 8.47148 9.73646C8.1083 10.3536 8.30809 11.1052 8.5061 11.6262C8.52907 11.6866 8.561 11.7421 8.6011 11.7929C9.69086 13.171 11.7482 15.2883 13.675 10.1581C13.6867 10.1269 13.6966 10.0936 13.703 10.0609C13.8531 9.29375 13.8556 7.83553 13.8654 7.03581C13.9241 2.132 8.34308 1.48826 9.54661 5.38079Z" fill="#FBA907"/></svg>`,
    NOISE: `<svg width="26" height="26" viewBox="0 0 26 26" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="26" height="26" rx="13" fill="white"/><path d="M4.72656 14.7148L7.86294 14.1839L8.90998 20.369C8.97613 20.7598 8.71296 21.1302 8.32217 21.1964L6.60099 21.4877C6.21019 21.5539 5.83976 21.2907 5.7736 20.8999L4.72656 14.7148Z" fill="#FBA907"/><path d="M4.72656 14.7148L7.86294 14.1839L8.28724 16.6903L5.15086 17.2213L4.72656 14.7148Z" fill="#F28D00"/><path d="M14.2221 17.221C11.4874 16.0583 8.43311 15.4908 5.97554 15.6233L4.99473 9.82943C7.05922 9.17489 10.7781 7.58472 12.6141 5.58084L14.2221 17.221Z" fill="#FFDD99"/><path d="M2.37377 12.2157C2.16784 10.9993 2.98582 9.84583 4.20191 9.63782L5.1838 9.46986C5.50388 9.41512 5.80764 9.63053 5.86184 9.9507L6.72726 15.0629C6.78149 15.3833 6.56527 15.6868 6.24477 15.7402L5.26077 15.9042C4.04454 16.1069 2.89369 15.287 2.68789 14.0713L2.37377 12.2157Z" fill="#FBA907"/><rect x="11.9375" y="5.10156" width="1.76178" height="12.9197" rx="0.880892" transform="rotate(-9.60823 11.9375 5.10156)" fill="#FBA907"/><path d="M22.2803 11.3332L18.2451 12.1137C18.0142 12.1583 17.848 11.8656 18.0298 11.7343L19.3521 10.7792C19.4681 10.6954 19.4482 10.5191 19.3133 10.4348L18.8247 10.1293C18.6534 10.0222 18.6794 9.78675 18.8667 9.75053L23.1213 8.92761C23.3714 8.87924 23.53 9.21497 23.3085 9.32382L21.696 10.1163C21.5617 10.1823 21.5564 10.3635 21.6859 10.4632L22.343 10.9688C22.4935 11.0846 22.4566 11.2991 22.2803 11.3332Z" fill="#FBA907"/><path d="M19.7076 6.26087L16.3625 8.28159C16.1678 8.39919 15.8862 8.22407 15.9837 8.04597L16.7456 6.65292C16.8041 6.54584 16.72 6.41771 16.5708 6.3868L15.837 6.23479C15.6381 6.1936 15.5748 5.99344 15.7308 5.89921L19.3117 3.73607C19.5248 3.60731 19.8207 3.82539 19.6705 4.0005L18.5109 5.35201C18.4245 5.45273 18.489 5.59591 18.641 5.64076L19.6261 5.93146C19.8084 5.98526 19.8546 6.17206 19.7076 6.26087Z" fill="#FBA907"/><path d="M18.4802 16.7262L22.5682 17.2769C22.802 17.3084 22.94 17.0024 22.7464 16.8818L21.3497 16.011C21.2255 15.9336 21.2294 15.753 21.3574 15.6603L21.8058 15.3356C21.9676 15.2184 21.9212 14.9813 21.7314 14.9557L17.4283 14.3761C17.1754 14.342 17.0487 14.6903 17.2792 14.7862L18.9443 15.4787C19.0848 15.5371 19.1063 15.7209 18.9852 15.8287L18.3864 16.362C18.2461 16.4869 18.3015 16.7021 18.4802 16.7262Z" fill="#FBA907"/></svg>`,
    SECURITY: `<svg width="26" height="26" viewBox="0 0 26 26" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="26" height="26" rx="13" fill="white"/><path d="M12.9994 15.6836C11.3587 15.6836 9.82773 16.05 8.68218 16.754C7.53744 17.4575 6.6836 18.5709 6.6836 20.0556L6.6836 20.3209C6.68357 20.472 6.68355 20.6258 6.69297 20.7573C6.70345 20.9037 6.7287 21.0852 6.81123 21.27C6.92349 21.5214 7.10263 21.7258 7.32297 21.8538C7.48494 21.948 7.64408 21.9768 7.77233 21.9887C7.88761 21.9994 8.02246 21.9994 8.15492 21.9994L17.844 21.9987C17.9765 21.9987 18.1113 21.9988 18.2266 21.988C18.3548 21.976 18.5139 21.9472 18.6759 21.8531C18.8962 21.725 19.0753 21.5206 19.1876 21.2693C19.2701 21.0845 19.2953 20.903 19.3058 20.7567C19.3152 20.6251 19.3152 20.4713 19.3152 20.3202L19.3152 20.0556C19.3152 18.5709 18.4613 17.4575 17.3166 16.754C16.171 16.05 14.64 15.6836 12.9994 15.6836Z" fill="#FBA907"/><path d="M9.1601 17.1815L11.0972 19.506C11.2655 19.708 11.5758 19.708 11.7441 19.506L13.6812 17.1815C13.8643 16.9617 13.7797 16.6272 13.5141 16.521L11.577 15.7461C11.4766 15.706 11.3647 15.706 11.2643 15.7461L9.32718 16.521C9.06158 16.6272 8.97696 16.9617 9.1601 17.1815Z" fill="#F28D00"/><path d="M16.8399 17.1815L14.9028 19.506C14.7345 19.708 14.4242 19.708 14.2559 19.506L12.3188 17.1815C12.1357 16.9617 12.2203 16.6272 12.4859 16.521L14.423 15.7461C14.5234 15.706 14.6353 15.706 14.7357 15.7461L16.6728 16.521C16.9384 16.6272 17.023 16.9617 16.8399 17.1815Z" fill="#F28D00"/><ellipse cx="13.0014" cy="13.0532" rx="5.26316" ry="4.73684" fill="#FFDD99"/><path d="M8.79071 13.0516C8.79071 14.1042 8.08379 14.6306 7.21176 14.6306C6.33973 14.6306 5.63281 13.9236 5.63281 13.0516C5.63281 12.1796 6.33973 11.4727 7.21176 11.4727C8.08379 11.4727 8.79071 12.1796 8.79071 13.0516Z" fill="#FFDD99"/><path d="M17.2093 13.0516C17.2093 14.1042 17.9162 14.6306 18.7882 14.6306C19.6603 14.6306 20.3672 13.9236 20.3672 13.0516C20.3672 12.1796 19.6603 11.4727 18.7882 11.4727C17.9162 11.4727 17.2093 12.1796 17.2093 13.0516Z" fill="#FFDD99"/><path d="M5.78077 9.06712C5.12236 8.07951 5.41013 6.74316 6.41666 6.11407L8.53603 4.78947C11.2667 3.08278 14.7316 3.08278 17.4623 4.78947L19.5817 6.11407C20.5882 6.74316 20.876 8.07952 20.2176 9.06712L19.315 10.4211H6.68339L5.78077 9.06712Z" fill="#F28D00"/><path d="M19.4582 9.83828C19.8862 10.4672 19.5263 11.3284 18.7781 11.4658L15.2807 12.1082C13.772 12.3853 12.2255 12.3853 10.7169 12.1082L7.21941 11.4658C6.47123 11.3284 6.11136 10.4672 6.53935 9.83828L6.60681 9.73915C6.76759 9.5029 7.01752 9.34217 7.29918 9.29389L10.8645 8.68269C12.277 8.44054 13.7205 8.44054 15.133 8.68269L18.6984 9.29389C18.98 9.34217 19.2299 9.5029 19.3907 9.73915L19.4582 9.83828Z" fill="#FBA907"/><path d="M11.0647 6.71596C10.9876 6.40759 11.267 6.12826 11.5753 6.20536L12.0462 6.32307C12.2087 6.3637 12.3804 6.34485 12.5302 6.26994L12.8115 6.12931C12.93 6.07004 13.0696 6.07004 13.1881 6.12931L13.4694 6.26994C13.6192 6.34485 13.7909 6.3637 13.9534 6.32307L14.4243 6.20536C14.7326 6.12826 15.012 6.40759 14.9349 6.71596L14.4816 8.52905C14.4319 8.72779 14.2978 8.8949 14.1146 8.98652L13.1881 9.44978C13.0696 9.50905 12.93 9.50905 12.8115 9.44978L11.885 8.98652C11.7017 8.8949 11.5677 8.72779 11.518 8.52905L11.0647 6.71596Z" fill="#FFEFCF"/><circle cx="10.3701" cy="13.0537" r="0.526316" fill="#F28D00"/><circle cx="15.6318" cy="13.0537" r="0.526316" fill="#F28D00"/></svg>`,
    TRAFFIC: `<svg width="26" height="26" viewBox="0 0 26 26" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="26" height="26" rx="13" fill="white"/><path d="M5.87119 7.67455C5.95037 6.64522 6.5948 5.74509 7.5437 5.33841C11.028 3.84515 14.972 3.84515 18.4563 5.33841C19.4052 5.74509 20.0496 6.64522 20.1288 7.67455L20.789 16.2568C20.9028 17.7366 19.7328 19 18.2487 19H7.75128C6.26718 19 5.09719 17.7366 5.21101 16.2568L5.87119 7.67455Z" fill="#FBA907"/><path d="M8 19H11L8.29289 21.7071C8.10536 21.8946 7.851 22 7.58579 22H5.96569C5.60932 22 5.43086 21.5691 5.68284 21.3172L8 19Z" fill="#FBA907"/><path d="M18 19H15L17.7071 21.7071C17.8946 21.8946 18.149 22 18.4142 22H20.0343C20.3907 22 20.5691 21.5691 20.3172 21.3172L18 19Z" fill="#FBA907"/><path d="M7 9C7 7.89543 7.89543 7 9 7H17C18.1046 7 19 7.89543 19 9V11C19 11.5523 18.5523 12 18 12H8C7.44772 12 7 11.5523 7 11V9Z" fill="#FFEFCF"/><rect x="10" y="16" width="6" height="2" rx="1" fill="#F28D00"/><circle cx="8.3" cy="14.6984" r="1.3" fill="#FFEFCF"/><circle cx="17.6984" cy="14.6984" r="1.3" fill="#FFEFCF"/></svg>`,
  };

  const inner = wrapper.querySelector('#pin-inner-icon') as HTMLDivElement | null;
  if (inner) {
    if (type === 'PROPERTY') {
      inner.innerHTML = HOUSE;
    } else {
      const allowed: NearbyTag[] = ['BAD', 'CONVENIENCE', 'GOOD', 'NOISE', 'SECURITY', 'TRAFFIC'];
      const normalized = typeof nearTag === 'string' ? (nearTag as string).toUpperCase() : 'GOOD';
      const finalTag = (allowed as readonly string[]).includes(normalized)
        ? (normalized as NearbyTag)
        : 'GOOD';
      inner.innerHTML = NEARBY[finalTag];
    }
  }

  if (active) {
    wrapper.style.filter = 'drop-shadow(0 3px 10px rgba(0,0,0,0.25))';
  }
  if (onClick) {
    wrapper.addEventListener('click', (e) => {
      e.stopPropagation();
      onClick();
    });
  }
  return wrapper;
}
